<h1> Overview of Edge Microgateway </h1>
<p style="text-align: right;"><em>Edge Microgateway v. 2.4.x</em></p>
<h2><em style="text-align: right;">Audience</em></h2>
<p><em style="text-align: right;">This topic is a general introduction to Edge Microgateway intended for all audiences.</em></p>
<h2><em style="text-align: right;">What is Apigee Edge Microgateway?</em></h2>
<p><em style="text-align: right;">Apigee Edge Microgateway is a secure, HTTP-based message processor for APIs. Its main job is to process requests and responses to and from backend services securely while asynchronously pushing valuable API execution data to Apigee Edge where it is consumed by the Edge Analytics system. Edge Microgateway is easy to install and deploy -- you can have an instance up and running within minutes.</em></p>
<p><em style="text-align: right;">Typically, Edge Microgateway is installed within a trusted network in close proximity to backend target services. It provides enterprise-grade security, and some key plugin features such as spike arrest, quota, and analytics, but not the full capabilities or footprint of Apigee Edge. You can install Edge Microgateway &nbsp;in the same data center or even on the same machine as your backend services if you wish.</em></p>
<h2><em style="text-align: right;">Primary use cases</em></h2>
<p><em style="text-align: right;">Typical use cases for a hybrid Cloud API management solution such as Edge Microgateway include:</em></p>
<ul>
	<li>
		<p><em style="text-align: right;">Reduce latency of API traffic for services that run in close proximity. For example, if your API consumers and producers are in close proximity, you do not necessarily want APIs to go through a central gateway.</em></p>
	</li>
	<li><em style="text-align: right;">Keep API traffic within the enterprise-approved boundaries for security or compliance purposes.</em></li>
	<li><em style="text-align: right;">Continue processing messages if internet connection is temporarily lost.</em></li>
	<li><em style="text-align: right;">See also this use case discussion in the&nbsp;<a href="https://community.apigee.com/questions/16727/what-do-you-think-use-cases-are-for-hybrid-deploym.html">Apigee Community</a>.</em></li>
</ul>
<h2><em style="text-align: right;">Key features and benefits</em></h2>
<ul>
	<li><em style="text-align: right;"><strong>Security</strong>.&nbsp;Edge Microgateway authenticates requests with a signed access token or API key issued to each client app by Apigee Edge.</em></li>
	<li><em style="text-align: right;"><strong>Rapid deployment</strong>.&nbsp;Unlike a full deployment of Apigee Edge, you can deploy and run an instance of Edge Microgateway within a matter of minutes.</em></li>
	<li><em style="text-align: right;"><strong>Network proximity</strong>.&nbsp;You can install and manage Edge Microgateway in the same machine, subnet, or data center as the backend target APIs with which Edge Microgateway interacts.</em></li>
	<li><em style="text-align: right;"><strong>Analytics</strong>.&nbsp;Edge Microgateway asynchronously delivers API execution data to Apigee Edge, where it is processed by the Edge Analytics system. You can use the full suite of Edge Analytics metrics, dashboards, and APIs.</em></li>
	<li><em style="text-align: right;"><strong>Reduced latency</strong>.&nbsp;All communication with Apigee Edge is asynchronous and does not happen as part of processing client API requests. This allows Edge Microgateway to collect API data and send it to Apigee Edge without affecting latency.</em></li>
	<li><em style="text-align: right;"><strong>Familiarity</strong>.&nbsp;Edge Microgateway uses and interacts with Apigee Edge features that Edge administrators already understand well, such as proxies, products, and developer apps.</em></li>
	<li><em style="text-align: right;"><strong>Configuration</strong>.&nbsp;No programming is required to set up and manage Edge Microgateway. Everything is handled through configuration.</em></li>
	<li><em style="text-align: right;"><strong>Convenience</strong>.&nbsp;You can integrate Edge Microgateway with your existing application monitoring and management infrastructure and processes.</em></li>
	<li><em style="text-align: right;"><strong>Simple</strong>.&nbsp;It's simple to install, configure, and maintain.</em></li>
	<li><em style="text-align: right;"><strong>Logging</strong>.&nbsp;Log files detail all the normal and exceptional events encountered during API processing by Edge Microgateway.</em></li>
	<li><em style="text-align: right;"><strong>CLI</strong>.&nbsp;A command-line interface lets you start, stop, and restart Edge Microgateway, extract operating statistics, view log files, request access tokens, and more.</em></li>
</ul>
<h2><em style="text-align: right;">What you need to know about Edge Microgateway</em></h2>
<p><em style="text-align: right;">This section describes how Edge Microgateway works, its basic architecture, configuration, and deployment.</em></p>
<div class="note">
	<p><em style="text-align: right;">A good way to become familiar with Edge Microgateway is to set it up and run it. See the <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a> for all the steps and practical illustrations of many of the concepts discussed in this section.</em></p>
</div>
<h3><em style="text-align: right;">Why use Edge Microgateway?</em></h3>
<p><em style="text-align: right;">Moving the API management component close to backend target applications can reduce network latency. While you can install Apigee Edge on-premises in a private cloud, a full deployment of Apigee Edge is necessarily large and complex to support its full feature-set and data-heavy features like key management, monetization, and analytics. This means that deploying Apigee Edge on premises in each&nbsp;data-center is not always desirable.</em></p>
<p><em style="text-align: right;">With Edge Microgateway, you get a relatively small footprint application running close to your backend applications. And, you get to leverage full Apigee Edge for analytics, security, and other features.</em></p>
<h3><em style="text-align: right;">Sample deployment scenarios</em></h3>
<p><em style="text-align: right;">This section illustrates several possible deployment scenarios for Edge Microgateway.</em></p>
<p><em style="text-align: right;"><strong>Same machine</strong></em></p>
<p><em style="text-align: right;">Figure 1 shows the request processing path when Edge Microgateway is deployed in its most simple possible configuration, where Edge Microgateway and the backend target APIs are installed on the same machine.&nbsp;A single Edge Microgateway instance can be used to front multiple backend target applications</em></p>
<p><em style="text-align: right;"><strong>Figure 1:</strong>&nbsp;The most simple deployment of Edge Microgateway</em></p>
<p style="text-align: center;"><em style="text-align: right;"><img alt="" src="sites/docs/files/Microgateway-Fig1.png" style="width: 600px; height: 542px;" /></em></p>
<p><em style="text-align: right;">&nbsp;</em></p>
<p><em style="text-align: right;"><strong>Different machine</strong></em></p>
<p><em style="text-align: right;">Because all the communication between clients, Edge Microgateway, and backend API implementations is HTTP, you can install Apigee Edge Microgateway on a different machine from the API implementation, as shown in Figure 2.</em></p>
<p><em style="text-align: right;"><strong>Figure 2:&nbsp;</strong>Edge Microgateway separated from backend target APIs</em></p>
<p style="text-align: center;"><em style="text-align: right;"><img alt="" src="sites/docs/files/Microgateway-Fig2.png" style="width: 709px; height: 542px;" /></em></p>
<p><em style="text-align: right;">&nbsp;</em></p>
<p><em style="text-align: right;"><strong>With load balancer</strong></em></p>
<p><em style="text-align: right;">Edge Microgateway&nbsp;itself can be front-ended by a standard reverse proxy or load-balancer for SSL termination and/or load-balancing, as shown in Figure 3.</em></p>
<p><em style="text-align: right;"><strong>Figure 3:</strong>&nbsp;Running Edge Microgateway with a load balancer</em></p>
<p style="text-align: center;"><em style="text-align: right;"><img alt="" src="sites/docs/files/Microgateway-Fig3d.png" style="width: 700px; height: 548px;" /></em></p>
<p><em style="text-align: right;"><strong>Intranet deployment</strong></em></p>
<p><em style="text-align: right;">Use Edge Microgateway to protect intranet&nbsp;traffic while protecting internet traffic with Apigee Edge, as illustrated in Figure 4. Let's say an API endpoint&nbsp;<code>/orders</code>&nbsp;is proxied through Apigee Edge Cloud, and it hits the backend target&nbsp;<code>https://mycompany.com/orders</code>. This is represented by the target API implementation on the left. This API may then call multiple API endpoints represented by the target implementation on the right. For example, it may call internally&nbsp;<code>/customers</code>&nbsp;and&nbsp;<code>/transactions</code>. See also&nbsp;<a href="https://community.apigee.com/questions/22172/microgateway-docs-query-internet-intranet-deployme.html">this post</a>&nbsp;on the Apigee Community.&nbsp;</em></p>
<p><em style="text-align: right;"><strong>Figure 4:</strong>&nbsp;Running Edge Microgateway to protect intranet traffic</em></p>
<p style="text-align: center;"><em style="text-align: right;"><img alt="" src="sites/docs/files/Microgateway-Fig4.png" style="width: 735px; height: 400px;" /></em></p>
<p><em style="text-align: right;">&nbsp;</em></p>
<h3><em style="text-align: right;">Dependency on Apigee Edge</em></h3>
<p><em style="text-align: right;">Edge Microgateway depends on and interacts with Apigee Edge. Edge Microgateway must communicate with Apigee Edge to function. The primary ways that Edge Microgateway interacts with Edge are:</em></p>
<ul>
	<li><em style="text-align: right;">Upon startup, Edge Microgateway obtains a list of special "Edge Microgateway-aware" proxies and a list of all of the products from your Apigee Edge organization. For each incoming client request, Edge Microgateway determines if the request matches one of these API proxies and then validates the incoming access token or API key based on the keys in the product associated with that proxy.</em></li>
	<li><em style="text-align: right;">The Apigee Edge Analytics system stores and processes API data sent asynchronously from Edge Microgateway.</em></li>
	<li><em style="text-align: right;">Apigee Edge provides credentials used to sign access tokens&nbsp;or provide API keys that are required by clients making API calls through Edge Microgateway. You can obtain these tokens using a CLI command.</em></li>
</ul>
<h3><em style="text-align: right;">One-time configuration</em></h3>
<p><em style="text-align: right;">You must initially configure Edge Microgateway to be able to communicate with your Apigee Edge organization. On startup, Edge Microgateway initiates a bootstrapping operation with Apigee Edge. &nbsp;Edge Microgateway retrieves from Apigee Edge the information it requires to process API calls on its own, including the list of Edge Microgateway-aware proxies that are deployed on Apigee Edge. We'll talk more about these proxies shortly.</em></p>
<p><em style="text-align: right;">Edge Microgateway does not have to be co-located with Apigee Edge; Apigee Edge public and private cloud offerings work equally well.</em></p>
<p><em style="text-align: right;">If you want to learn by doing, jump to <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>, which walks through the process of setting up and configuring Edge Microgateway using a convenient CLI command.</em></p>
<h3><em style="text-align: right;"><a id="What you need to know about Edge Microgateway-aware proxies" name="What you need to know about Edge Microgateway-aware proxies"></a>What you need to know about Edge Microgateway-aware proxies</em></h3>
<p><em style="text-align: right;">Edge Microgateway-aware proxies provide Edge Microgateway with certain information that allows it to process client API requests. Information about these proxies is downloaded from Apigee Edge to Edge Microgateway when Edge Microgateway starts up.</em></p>
<p><em style="text-align: right;">It is up to you or your API team to create these proxies on Apigee Edge using the Apigee Edge management UI or through other means if you wish. It's easy to do, and we walk through the details in the <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>.</em></p>
<div class="note">
	<p><em style="text-align: right;">Edge Microgateway-aware proxies must point to an HTTP target endpoint. In other words, the TargetEndpoint for the proxy must include an HTTPTargetConnection. Edge Microgateway is not designed to work with proxies that use the ScriptTarget element to point to Node.js applications as backend targets. See also <a href="http://docs.apigee.com/node/6858">http://docs.apigee.com/node/6858</a> and&nbsp;<a href="http://docs.apigee.com/api-services/content/adding-nodejs-existing-api-proxy#specifythenodejstargetwithscripttarget">Specify the Node.js target with ScriptTarget</a>.&nbsp;</em></p>
</div>
<p><em style="text-align: right;">The characteristics of Edge Microgateway-aware proxies include:</em></p>
<ul>
	<li><em style="text-align: right;">Micro-aware proxies provide Edge Microgateway with two key pieces of information: a base path and target URL.</em></li>
	<li><em style="text-align: right;">Micro-aware proxies must point to HTTP target endpoints. The backend target cannot be a Node.js app referenced by a ScriptTarget element in the TargetEndpoint definition. See the preceding note for more information.&nbsp;</em></li>
	<li><em style="text-align: right;">The proxy names must be prefixed with&nbsp;<code><strong>edgemicro_</strong></code>. For example:&nbsp;<strong><code>edgemicro_weather</code></strong>.</em></li>
	<li><em style="text-align: right;">Edge Microgateway proxies cannot be edited in the Proxy Editor of the Apigee Edge management UI. That is, you can't add policies or add conditional flows. (Or, if you try, they are ignored.)</em></li>
	<li><em style="text-align: right;">Otherwise, Edge Microgateway proxies appear in the Edge Management UI the same as any other API proxy on Edge.</em></li>
	<li><em style="text-align: right;">Like with any API proxy on Edge, Edge Microgateway proxies can be bundled into products and associated with developer apps.</em></li>
	<li><em style="text-align: right;">Like with any other proxy, you can track Edge Microgateway proxy analytics.</em></li>
	<li><em style="text-align: right;">Edge Microgateway proxies cannot be traced using the Apigee Edge Trace tool.</em></li>
</ul>
<h3><em style="text-align: right;">More about Edge Microgateway and Apigee Edge Analytics</em></h3>
<p><em style="text-align: right;">As API traffic flows through Edge Microgateway, Edge Microgateway buffers and asynchronously sends API execution data to Apigee Edge, where the data is stored and processed by the Edge Analytics system. This asynchronous communication allows Edge Microgateway to take advantage of Edge analytics features, while maintaining a relatively small footprint with minimal processing overhead or blocking. The full suite of Edge Analytics dashboards and custom reporting capabilities are available to you and your team to analyze traffic that passes through Edge Microgateway.</em></p>
<p><em style="text-align: right;"><strong>Figure 6:</strong>&nbsp;Proxy Traffic dashboard on Edge</em></p>
<p><em style="text-align: right;"><img alt="" src="sites/docs/files/em-admin-fig-6.png" style="width: 700px; height: 484px; border-width: 1px; border-style: solid;" /></em></p>
<p><em style="text-align: right;">&nbsp;For more information about Edge Analytics, see <a href="http://docs.apigee.com/node/15656">http://docs.apigee.com/node/15656</a>.</em></p>
<h3><em style="text-align: right;">About Edge Microgateway security</em></h3>
<p><em style="text-align: right;"><strong>Role of Apigee Edge</strong></em></p>
<p><em style="text-align: right;">As mentioned previously, Apigee Edge plays a role in securing all client requests to Edge Microgateway. The primary roles Apigee Edge plays are:</em></p>
<ul>
	<li><em style="text-align: right;">Providing client credentials used as API keys or to generate valid access tokens used by clients to make secure API calls through Edge Microgateway.</em></li>
	<li><em style="text-align: right;">Providing credentials that Edge Microgateway needs to send API execution data to the Apigee Edge Analytics system. These credentials are obtained once by Edge Microgateway during the initial setup steps. (See the <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a> for detailed steps.)</em></li>
	<li><em style="text-align: right;">Providing the platform for bundling API resources into products, registering and managing developers, and creating and managing developer apps.</em></li>
</ul>
<p><em style="text-align: right;"><strong>Client app authentication</strong></em></p>
<ul>
	<li><em style="text-align: right;">The Edge Microgateway supports client authentication through access tokens and API keys.&nbsp;Security keys and tokens are generated by Apigee Edge and validated by Edge Microgateway for each API call.</em></li>
	<li><em style="text-align: right;">If the oauth plugin is enabled, Edge Microgateway checks a signed access token or API key and if it's valid, the API call proceeds to the backend target. If it isn't valid, an error is returned.</em></li>
	<li><em style="text-align: right;">See the&nbsp;<a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>&nbsp;for steps needed to obtain and use access tokens. For information about API keys, see "Using API Key security" in <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>.</em></li>
</ul>
<div class="note">
	<p><em style="text-align: right;">Edge Microgateway cannot be used to invoke regular Apigee Edge API proxies, as explained in detail in the discussion of creating&nbsp;<a href="http://docs.apigee.com/microgateway/v2.4.x/edge-microgateway-tutorial-v2.4.x#part2createentitiesonapigeeedge">microgateway-aware proxies</a>. The OAuth2 access tokens that you obtain and use with Edge Microgateway are not the same as the access tokens issued by Edge and enforced by Edge through its native OAuthV2 policy. To use OAuth2 with Edge Microgateway you must follow the specific instructions provided in the topic&nbsp;<a href="http://docs.apigee.com/microgateway/v2.4.x/edge-microgateway-tutorial-v2.4.x#part4secureedgemicrogateway-secureapicallswithanoauth2accesstoken">Secure API calls with an OAuth2 access token</a>.&nbsp;</em></p>
</div>
<div class="note">
	<p><em style="text-align: right;">Edge Microgateway&nbsp;<a href="http://docs.apigee.com/microgateway/v2.4.x/edge-microgateway-tutorial-v2.4.x#part2createentitiesonapigeeedge">does not invoke regular Edge API proxies</a>. An access token generated for Edge Microgateway cannot be used to invoke Edge proxies protected by the OAuthV2 policy. Conversely, access token granted to access Edge proxies cannot be used to access APIs called through Edge Microgateway.&nbsp;To use OAuth2 with Edge Microgateway you must follow the specific instructions provided in the topic&nbsp;<a href="http://docs.apigee.com/microgateway/v2.4.x/edge-microgateway-tutorial-v2.4.x#part4secureedgemicrogateway-secureapicallswithanoauth2accesstoken">Secure API calls with an OAuth2 access token</a>.</em></p>
</div>
<p><em style="text-align: right;"><strong>Authentication of Edge Microgateway on Apigee Edge</strong></em></p>
<ul>
	<li><em style="text-align: right;">The asynchronous calls Edge Microgateway makes to update analytics data on Apigee Edge require authentication. This authentication is provided through a public/secret key pair passed to Edge Microgateway through the CLI or using environment variables. You obtain and use these keys once when you first install and start up Edge Microgateway.</em></li>
</ul>
<p><em style="text-align: right;"><strong>API product management platform</strong></em></p>
<ul>
	<li><em style="text-align: right;">Edge serves as a platform for bundling API resources into products, registering and managing developers, and creating and managing developer apps. For example, just as you can create and bundle entities like products and developer apps for regular Apigee Edge proxies, you can do exactly the same for Edge Microgateway proxies. API-level security is made possible by generating public and private security keys for each "bundle." This mechanism is identical to the way API security works on Apigee Edge.</em></li>
</ul>
<h3><em style="text-align: right;">Can I move my existing Edge proxy implementations to Edge Microgateway?</em></h3>
<p><em style="text-align: right;">You cannot migrate existing proxies with associated policies or conditional flows to Edge Microgateway. Edge Microgateway requires you to create new "microgateway-aware" proxies. These proxies must be named with a special prefix, edgemicro_. Upon startup, Edge Microgateway discovers these edgemicro_* proxies and downloads configuration information for each of them. This information includes their target URLs and resource paths. From that point on, the proxies are not used. Any policies or conditional flows in these proxies will never execute.</em></p>
<p><em style="text-align: right;">Another reason for having microgateway-aware proxies is that Edge Microgateway asynchronously pushes analytics data to Edge for each microgateway-aware proxy. You can then view the analytics data for microgateway-aware proxies &nbsp;just as you would for any other proxy in the Edge Analytics UI.&nbsp;</em></p>
<p><em style="text-align: right;">The setup topic walks you through all the steps you need to do to begin proxying API calls through Edge Microgateway, including a few simple steps you need to do on Apigee Edge to set up a configuration that Edge Microgateway needs, including creation of microgateway-aware proxies. &nbsp;See <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>.</em></p>
<h3><em style="text-align: right;">Can I use policies with Edge Microgateway proxies?</em></h3>
<p><em style="text-align: right;">As explained in the previous section, you cannot attach policies to "microgateway-aware" proxies in Apigee Edge. Edge Microgateway uses&nbsp;<strong>plugins</strong>&nbsp;to provide functionality similar to policies in Edge, such as quota, spike arrest, API key security, and OAuth2 security. See <a href="http://docs.apigee.com/node/37651">http://docs.apigee.com/node/37651</a>. You can also write custom plugins, as explained in <a href="http://docs.apigee.com/node/37671">http://docs.apigee.com/node/37671</a>.</em></p>
<h2><em style="text-align: right;">What's the best way to learn about Edge Microgateway?</em></h2>
<p><em style="text-align: right;">Apigee provides these resources:</em></p>
<ul>
	<li>
		<p><em style="text-align: right;"><a href="http://docs.apigee.com/microgateway/content/edge-microgateway-home">Edge Microgateway Documentation</a>&nbsp;- The docs include a getting started tutorial as well as complete reference and configuration information.</em></p>
	</li>
	<li>
		<p><em style="text-align: right;"><a href="https://www.youtube.com/watch?v=cSeSMQ5sMJc">Deep-dive webinar</a>&nbsp;- Discusses Edge Microgateway in detail and demonstrates how to setup and configure Edge Microgateway.</em></p>
	</li>
	<li>
		<p><em style="text-align: right;"><a href="https://community.apigee.com/spaces/71/index.html">Edge Micro forum</a>&nbsp;- The Edge Micro forum on the&nbsp;<a href="https://community.apigee.com/">Apigee Community</a>&nbsp;is a great place to ask questions and benefit from questions asked, and answered, by others.</em></p>
	</li>
</ul>
