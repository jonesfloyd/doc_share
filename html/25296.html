<h1> Setting up and configuring Edge Microgateway </h1>
<em style="text-align: right;">Edge Microgateway v.&nbsp;2.3.x</em>
<h2>Overview</h2>
<div class="paid">
	<p>You can only use Edge Microgateway with paid accounts for Edge Public Cloud. If you're using Edge Private Cloud, you can use Edge Microgateway with both paid and free trial accounts. See the&nbsp;<a href="http://apigee.com/about/pricing/apigee-edge-pricing-features" target="_blank">Edge pricing features page</a>&nbsp;for more details.</p>
</div>
<p>This tutorial walks you through the steps required to get an instance of Edge Microgateway up and running.</p>
<p>After completing the steps here, you'll have a fully configured, working Edge Microgateway installation capable of processing API requests. You'll test the setup by making secure API calls through Edge Microgateway to a backend target. You will also learn how to add a spike arrest plugin to the Microgateway.&nbsp;</p>
<p>This guide is divided into these parts:</p>
<ul>
	<li><strong>Prerequisite:</strong>&nbsp;<a href="#Prerequisite">Installing Edge Microgateway</a></li>
	<li><strong>Part 1:</strong>&nbsp;<a href="#Part1">Configure Edge Microgateway</a></li>
	<li><strong>Part 2:</strong>&nbsp;<a href="#Part2">Create entities on Apigee Edge</a></li>
	<li><strong>Part 3:</strong>&nbsp;<a href="#Operating Edge Microgateway">Operate Edge Microgateway</a></li>
	<li><strong>Part 4:</strong>&nbsp;<a href="#Secure">Secure Edge Microgateway</a></li>
	<li><strong>Part 5:</strong>&nbsp;<a href="#Part4">Add the Spike Arrest plugin</a></li>
	<li><strong>Part 6:</strong>&nbsp;<a href="#Part5">View Analytics data on Apigee Edge</a></li>
</ul>
<p>&nbsp;</p>
<h2><a id="Prerequisite" name="Prerequisite"></a>Prerequisite: Install Edge Microgateway</h2>
<p>Follow the instructions in <a href="http://docs.apigee.com/node/25291">http://docs.apigee.com/node/25291</a>. When you complete the installation, you'll be ready to follow the steps in this tutorial.&nbsp;</p>
<p>When you are finished with the installation, proceed to the next section, "<a href="#Part1">Part 1: Configure Edge Microgateway</a>".</p>
<h2><a id="Part1" name="Part1"></a>Part 1: Configure Edge Microgateway</h2>
<p>In this part you'll use a command-line interface (CLI) command to configure Edge Microgateway to communicate with Apigee Edge. If you are using Apigee Edge Cloud, then follow the&nbsp;<a href="#Cloud config">Apigee Edge Cloud configuration steps</a>. If you are on Apigee Private Cloud, follow the&nbsp;<a href="#Private config">steps for Apigee Edge Private Cloud</a>.</p>
<div class="note">
	<p>Why does Edge Microgateway need to communicate with Edge? See "Dependency on Apigee Edge" in <a href="http://docs.apigee.com/node/25286">http://docs.apigee.com/node/25286</a></p>
</div>
<h3><a id="Cloud config" name="Cloud config"></a>Apigee Edge Cloud configuration steps</h3>
<p>Follow these steps to use Edge Microgateway with Apigee Edge Cloud:</p>
<ol>
	<li>If you haven't done so previously, initialize Edge Microgateway (you only need to do this step one time):<br />
		<pre>
<strong>edgemicro init</strong></pre>
	</li>
	<li>(Optional) Print help for the&nbsp;<strong>edgemicro configure</strong>&nbsp;command:<br />
		<pre>
<strong>edgemicro configure -h</strong></pre>
	</li>
	<li>Execute the following command to configure Edge Microgateway:<br />
		<pre>
<strong>edgemicro configure -o [org] -e [env] -u [username] </strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><strong><code>username</code></strong>&nbsp;is the email address associated with your Apigee account.</li>
		</ul>
	</li>
</ol>
<p><strong>Example</strong></p>
<pre>
<strong>edgemicro configure -o docs -e test -u jdoe@example.com</strong></pre>
<p><strong>Output</strong></p>
<pre>
./edgemicro configure -o docs -e test -u jdoe@apigee.com
password:
current nodejs version is v6.1.0
current edgemicro version is 2.2.3-beta
password:
file doesn't exist, setting up
Give me a minute or two... this can take a while...
App edgemicro-auth deployed.
creating vault
adding private_key
adding public_key
configuring host edgemicroservices-us-east-1.apigee.net for region us-east-1

saving configuration information to: /Home/.edgemicro/wwitman-test-config.yaml

vault info:
 -----BEGIN CERTIFICATE-----
MIICpDCCAYwCCQCaDpaTttaDANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDEwls
b2NhbGhvc3QwHhcNMTYxAxMjA0NzIyWhcNMTYxMTAyMjA0NzIyWjAUMRIwEAYD
VQQDEwlsb2NhbGhvcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDA
YbtbsFe50GgBrI8QTih5yzxxxvCfdubGrLWmovwwCCFthno3u8lS54ekOL9jQu
JTJsocJfNhZxvnXifDsCk5Muwx87Z/D0BYLw9ZhM8TMyA2MCkXgC6RfKT69IdJ
jT3X+3D0s+apr3lACsDhgOfaeQfeHAm1SSwH/VemaJqdImGkQMtM8uscMDwG6k
vBbCSNS+hh6ZH1m3tAkcKXqvj/E1hbrHNTWr+uiYFRByUzeo1I607daQD4Lxid
il4Ng3hr3LC1gEzvobWgVyhQ2ovYB57T886H7dGghTnOUxLm2y/TwmQya+44SL
JSsDwauArMF38cRKZZ7VAgMBAAEwDQYJKoZIhvcNAQELBQADEBAHwwu+gOn8Tq
jKOYBTXtOX11HPMTxmyvZ/I57R4roE7Z/lXg/DXwbiFpFG2uamXNKq7yTDJH2i
iiqdERZOGfv7TJMjRlxEnfVHoCV7UKguKq4zeeAEU2x55yFwpWNrarx0kMXRwI
v3WgGfo2bimFQrCjDCNIkDKmYYt4SXIF5zUJmBWPCaK9aJoQb7ARXQO9s2zoOI
XZ5bCUDbehQZ+6LyqC0hgDXiIZYy7R0j93yCbQgoHaHUMEprJEEjE24SHdsWBO
nxGZxB20JLq5AHTm8lbZp7XtvbU0jVpxyrBo2/olFnmpvBVOq9eIp042IVD7nT
J4rPejdK6C4=
-----END CERTIFICATE-----

The following credentials are required to start edge micro
  key: e88ec9d5da17cd88ca338d532b7c7a8c4f43ddd3da139d95955ab345af30352d
  secret: d7f64854eb6889d06b809dd7c161dba5eeba4a2657277fd819921bf992221a8f

edgemicro configuration complete!
    </pre>
<ol></ol>
<div class="note">
	<p>You'll need the returned&nbsp;<strong>key</strong>&nbsp;and&nbsp;<strong>secret</strong>&nbsp;later when you start Edge Microgateway.</p>
</div>
<h3><a id="Private config" name="Private config"></a>Apigee Private Cloud configuration steps</h3>
<p>Follow these steps to use Edge Microgateway with Apigee Private Cloud:</p>
<ol>
	<li>Print help information for the&nbsp;<strong>edgemicro private configure</strong>&nbsp;command. You can print help this way for any Edge Microgateway CLI command or command option.
		<pre>
<strong>edgemicro private configure -h</strong></pre>
	</li>
	<li>Execute the following command. It requires standard information about your Apigee Edge Private Cloud account: organization name, environment name, username (email address), password, management server IP and router IP. You must be an Edge organization administrator to use this command:
		<pre>
<strong>edgemicro private configure -o [org] -e [env] -u [username] -r [runtime_url] -m [mgmt_url] -v [virtual_host]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><code><strong>org</strong></code>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><code><strong>env</strong></code>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><strong><code>runtime_url</code></strong>&nbsp;is the runtime URL for your private cloud instance.</li>
			<li><strong><code>mgmt_url</code></strong>&nbsp;is The URL of the management server for your private cloud instance.</li>
			<li><strong><code>username</code></strong>&nbsp;is the email address associated with your Apigee account.</li>
			<li><code><strong>virtual_host</strong></code>&nbsp;is a comma-separated list of virtual host names. The default values are&nbsp;<code>default,secure</code>
				<div class="note">
					<p>By default, the&nbsp;<strong>edgemicro-auth</strong>&nbsp;proxy expects to connect through a virtual host called&nbsp;<strong>secure</strong>. If your Private Cloud installation does not have this virtual host defined, you will receive a configuration error. Be sure to specify on the command line a&nbsp;<strong>virtual_host</strong>&nbsp;that exists. It is generally safe to specify a virtual host called&nbsp;<strong>default</strong>.&nbsp;</p>
				</div>
			</li>
		</ul>
	</li>
</ol>
<p><strong>Example</strong></p>
<pre>
<strong>edgemicro private configure -o docs -e test -u jdoe@example.com -r http://192.162.52.106:9001 -m http://192.162.52.106:8080 -v default</strong></pre>
<p>or, if you have a virtual host alias of&nbsp;<code>myorg-test.mycompany.com</code>, you would use a command like this:</p>
<pre>
<strong>edgemicro private configure -o docs -e test -u jdoe@example.com -r myorg-test.mycompany.com -m http://192.162.52.106:8080</strong> <strong>-v default</strong></pre>
<p><strong>Output</strong></p>
<pre>
delete cache config
checking for previously deployed proxies
configuring edgemicro internal proxy
deploying edgemicro internal proxy
deploying  edgemicro-auth  app
copy auth app into tmp dir
copy config into tmp deer
Give me a minute or two... this can take a while...
App edgemicro-auth added to your org. Now adding resources.

checking org for existing vault creating vault adding private_key adding public_key
configuring host http://192.168.52.106:9001 for region dc-1

saving configuration information to: /Users/ApigeeCorporation/.edgemicro/jdoe-test-config.yaml 
vault info: 
-----BEGIN CERTIFICATE----- 
MIICpDCCAYwCCQDpIvWlpaZJGDANBgkqhkiG9w0BAQFADAUMRIwEAYDVQQDEwls 
b2NhbGhvc3QwHhcNMTYwNDA3MTcxNTM5WhcNMTYwND4MTcxNTM5WjAUMRIwEAYD 
VQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEBAUAA4IBDwAwggEKAoIBAQD3 
OAQ+kf5FH0S0yuj05ITqUODuUJspBPberRMbqOZYHcFswhB0Yvg6JKWxKWBDP9o 
Xl96dtgH7xPFRqIU0zI452jkMQ1fPz2mSaGwik245yfBku7olooXKRKTRKOUoXa 
q3Hld/RPxGSsWtiyyYtKex7tuFdq0Knm1EhowdTRGIgjNvudeYMka/XPRXuykhd 
xIDxWj4rdX+4GPx9qT2eTQC5nOAC7XHVL7ys4KqsAiv28vw10u400KstFFS8Qho 
7FaE0bOKLolKKadKyA60ha1XIw/uSTD6ZQFWQ+XM3OaRbXePWXnSZioSxXcZT7L 
hMUKbsRXw/TCvRB51LgNAgMBAAEwDQYJKoZIhvcNAQELBQADgEBAOuR1OmE/W6j 
gRAarJB5EQuTEpI/9Zpg5c5RAGjzLhkazsycn7pal+IymUjCV7D0oIxTVuTM8ZZ 
57kR5hF/C1ZypDN9i+KGP2ovX8WOCCXYtIQECgZPB/L/7/k7BDuKN4vFBvWUe3X 
s2oyjnVWy+ASqsW8gHfj8ekhe22bP240Oqkbyg9SZP9ol1tvJX6+M0thYwcTwAd 
ft929Icey/MOTQC0jB2qm0gnIx/7KInFXfS5KoFRJoGrWDeckr3RdBo2LhnPaeZ 
1gPYIqphZ3HfisF5KlBXoR8oT/Ilym/nq5COlv+3L4tMIk18F7BQZB60SRazifz 
pFkIxepyr/0= 
-----END CERTIFICATE----- 

The following credentials are required to start edge micro 
   key: a3f8f3dfe39158fc3c50b274f0af2234246e0d5f6ea4dd09389b645147151ba3 
   secret: 3e9904802fb3c0e8ca408128a11119cf13546d54dac30ace944c097a726a1263

edgemicro configuration complete!
    </pre>
<div class="note">
	<p><strong>Important:</strong>&nbsp;If you have a virtual host alias defined, then use the alias for the&nbsp;<code>-r &lt;router-ip&gt;</code>&nbsp;parameter. You can view virtual hosts in the Edge UI for your organization, under<strong>&nbsp;APIs &gt; Environment Configuration &gt; Virtual Hosts</strong>.</p>
</div>
<h3>Verify the installation</h3>
<p>Run this command to verify the installation. If no errors are reported, everything is set up correctly and you will be able to start the Edge Microgateway successfully.&nbsp;</p>
<pre>
<strong>edgemicro verify -o [org] -e [env] -k [key] -s [secret]
</strong></pre>
<p>Where:</p>
<ul>
	<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
	<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
	<li><code><strong>key</strong></code>&nbsp;is the key returned previously by the configure command.</li>
	<li><code><strong>secret</strong></code>&nbsp;is the key returned previously by the configure command.</li>
</ul>
<p><strong>Example</strong></p>
<pre>
<strong>edgemicro verify -o docs -e test -k 93b01fd21d86331459ae52f664ae9aeb13eb94767ce40a4f621d172cdfb7e8e6 -s c8c755be97cf56c21f8b0556d7132afbd03625bbd85dc34ebfefae4f23fbcb3c</strong></pre>
<p>&nbsp;</p>
<h3>About the configuration</h3>
<p>All of the configuration done so far allows Edge Microgateway to bootstrap itself to Apigee Edge. After the bootstrapping succeeds, Edge Microgateway retrieves a payload of additional configuration information from Apigee Edge.</p>
<p>What is this configuration information used for? As we'll discover in the next part of this tutorial, when Edge Microgateway starts, it needs to receive a list of special Edge Microgateway-aware API proxies from Apigee Edge. In the next part of this tutorial, you will create a Microgateway-aware proxy. Edge Microgateway restricts clients to calling only the APIs fronted by these Microgateway-aware API proxies, and clients will be required (by default) to present a valid security token for each call. To read more about these proxies, see "What you need to know about Edge Microgateway-aware proxies in the <a href="http://docs.apigee.com/node/25286">http://docs.apigee.com/node/25286</a>.</p>
<p>As an Edge org admin, you'll be interested to know that Edge Microgateway-aware proxies can be added to Edge products, just like any other proxies. Through the use of products and developer apps, you can generate client-specific security tokens to control access to APIs called through Edge Microgateway. Again, the patterns involved are identical to working with any API proxies, products, and developer apps on Apigee Edge. If you'd like to read up on products, start with <a href="http://docs.apigee.com/node/14759">http://docs.apigee.com/node/14759</a> in the Edge documentation.</p>
<p>Next we'll walk through how to create Edge Microgateway-aware proxies, and after that, we'll start Edge Microgateway and test the setup.</p>
<p>&nbsp;</p>
<h2><a id="Part2" name="Part2"></a>Part 2: Create entities on Apigee Edge</h2>
<p>In this part, you will create these entities on Edge:</p>
<ul>
	<li><strong>A</strong>&nbsp;<strong>microgateway-aware proxy</strong>&nbsp;- This is a special proxy that Edge Microgateway can discover upon startup. Microgateway-aware proxies have a naming convention that you must follow: the name must being with&nbsp;<code><strong>edgemicro_</strong></code>. For example&nbsp;<code><strong>edgemicro_hello</strong></code>&nbsp;or&nbsp;<strong><code>edgemicro_userinfo</code></strong>. When Edge Microgateway starts, it retrieves from Edge a list of microgateway-aware proxies from the same Edge organization and environment that you specified when you started Edge Microgateway.<br />
		<br />
		For each microgateway-aware proxy, Edge Microgatway retrieves the target URL of the proxy and its base path. Microgateway-aware proxies also provide a convenient way to associate analytics data generated by Edge Microgateway with a proxy on the Edge platform. As the Microgateway handles API calls, it asynchronously pushes analytics data to Edge. Analytics data will show up in the Edge Analytics UI under the microgateway-aware proxy name(s), as it does for any other proxy.<br />
		&nbsp;</li>
	<li><strong>A product, developer, and developer app</strong>&nbsp;- Edge Microgateway uses products, developers, and developer apps to enable OAuth2 access token or API key security. When Edge Microgateway starts, it downloads all of the product configurations from your Apigee Edge organization. It uses this information to verify API calls made through Edge Microgateway with API keys or OAuth2 access tokens.</li>
</ul>
<p><strong>Read more:</strong>&nbsp;See also "What you need to know about Edge Microgateway-aware proxies" in the <a href="http://docs.apigee.com/node/25286">http://docs.apigee.com/node/25286</a>.</p>
<h3>1. Create an Edge Microgateway-aware API proxy on Edge</h3>
<div class="note">
	<p>These instructions are based on the Classic Edge user interface. After you log in to Edge, click&nbsp;<strong>Switch to Classic</strong>&nbsp;and then follow the steps in this section.</p>
</div>
<div class="note">
	<p>Edge Microgateway-aware proxies must point to an HTTP target endpoint. In other words, the TargetEndpoint for the proxy must include an HTTPTargetConnection. Edge Microgateway is not designed to work with proxies that use the ScriptTarget element to point to Node.js applications as backend targets. See also <a href="http://docs.apigee.com/node/6858">http://docs.apigee.com/node/6858</a> and&nbsp;<a href="http://docs.apigee.com/api-services/content/adding-nodejs-existing-api-proxy#specifythenodejstargetwithscripttarget">Specify the Node.js target with ScriptTarget</a>.&nbsp;</p>
</div>
<div class="note">
	<p><strong>Important:</strong>&nbsp;Do not attach policies or make conditional flows in microgateway-aware proxies, because they will never execute ON APIGEE EDGE. Microgateway-aware proxies are never called directly ON EDGE -- they only serve to provide configuration information to Edge Microgateway and as a way to surface analytics data in the Edge analytics system. If you want to add policy functionality, such as quota, spike arrest, or OAuth2 security, you need to use Edge Microgateway plugins. For details, see <a href="http://docs.apigee.com/node/25311">http://docs.apigee.com/node/25311</a>. See also <a href="http://docs.apigee.com/node/25316">http://docs.apigee.com/node/25316</a>.</p>
</div>
<ol>
	<li>Log in to your organization on Apigee Edge.</li>
	<li>Click&nbsp;<strong>SWITCH TO CLASSIC</strong>&nbsp;to go to the Edge Classic UI.</li>
	<li>Select&nbsp;<strong>APIs &gt; API Proxies</strong>&nbsp;from the top menu.</li>
	<li>In the API Proxies page, click&nbsp;<strong>+ API Proxy</strong>.</li>
	<li>In the Build a Proxy wizard, select&nbsp;<strong>Reverse proxy (most common)</strong>.</li>
	<li>Click&nbsp;<strong>Next</strong>.</li>
	<li>In the Details page of the wizard, configure as follows. Be sure to fill in the wizard exactly as shown:<br />
		<div class="note"><strong>Important:</strong>&nbsp;Edge Microgateway-aware proxy names&nbsp;<strong>must always begin</strong>&nbsp;with the prefix<strong>&nbsp;edgemicro_</strong>. For example:&nbsp;<code>edgemicro_hello</code>.</div>
		<ul>
			<li>Proxy Name:&nbsp;<strong>edgemicro_hello</strong></li>
			<li>Proxy Base Path:&nbsp;<strong>/hello</strong></li>
			<li>Existing API:&nbsp;<strong>http://mocktarget.apigee.net/</strong></li>
		</ul>
	</li>
	<li>Click&nbsp;<strong>Next</strong>.</li>
	<li>In the Security page of the wizard, select&nbsp;<strong>Pass through (none)</strong>.</li>
	<li>Click&nbsp;<strong>Next</strong>.</li>
	<li>In the Virtual Hosts page of the wizard, accept the defaults.</li>
	<li>Click&nbsp;<strong>Next</strong>.</li>
	<li>In the Build page of the wizard, review your proxy settings. Make sure the&nbsp;<strong>test</strong>&nbsp;environment is selected.</li>
	<li>Click&nbsp;<strong>Build and Deploy</strong>.</li>
</ol>
<h3>2. Create a product</h3>
<p>Create a product that contains two proxies:</p>
<ul>
	<li>Your microgateway-aware proxy:&nbsp;<strong>edgemicro_hello</strong></li>
	<li>The authentication proxy that was installed by Edge Microgateway:&nbsp;<strong>edgemicro-auth</strong>.</li>
</ul>
<ol>
	<li>In the Edge UI (Classic version), go to&nbsp;<strong>Publish &gt; Products</strong>.</li>
	<li>In the Products page, click&nbsp;<strong>+ Product</strong>. Fill out the Product Details page as follows:
		<ul>
			<li><strong>Name:</strong>&nbsp;EdgeMicroTestProduct</li>
			<li><strong>Display Name:</strong>&nbsp;EdgeMicroTestProduct</li>
			<li><strong>Environment:</strong>&nbsp;test and prod</li>
			<li><strong>Access:</strong>&nbsp;Public</li>
			<li><strong>Key Approval Type:</strong>&nbsp;Automatic</li>
			<li><strong>Resources:</strong>
				<ul>
					<li><strong>API Proxy:&nbsp;</strong>Select&nbsp;<strong>edgemicro_hello</strong></li>
					<li><strong>Revision:</strong>&nbsp;1</li>
					<li><strong>Resource Path:</strong>&nbsp;/**</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>Click&nbsp;<strong>Import Resource</strong>.</li>
	<li>In Resources, click<strong>&nbsp;+API Proxy</strong></li>
	<li>Select&nbsp;<strong>edgemicro-auth</strong></li>
	<li>Click&nbsp;<strong>Save</strong>.</li>
</ol>
<h3>3. (Optional) Create a test developer</h3>
<p>For the purpose of this tutorial, you can use any existing developer for the next step, creating a developer app. But if you wish, create a test developer now:</p>
<ol>
	<li>Go to&nbsp;<strong>Publish &gt; Developers</strong>.</li>
	<li>In the Products page, click&nbsp;<strong>+ Developer</strong>.</li>
	<li>Fill out the dialog to create a test developer.</li>
</ol>
<h3>4. Create a developer app</h3>
<p>You are going to use the client credentials from this app to make secure API calls through Edge Microgateway:</p>
<ol>
	<li>Go to&nbsp;<strong>Publish &gt; Developer Apps</strong>.</li>
	<li>In the Developer Apps page, click&nbsp;<strong>+ Developer App</strong>.</li>
	<li>Fill out the Developer App page as follows:
		<ol type="a">
			<li><strong>Name:</strong>&nbsp;EdgeMicroTestApp</li>
			<li><strong>Display Name:</strong>&nbsp;EdgeMicroTestApp</li>
			<li><strong>Developer:</strong>&nbsp;If you created a test developer, select it. Or, you can use any existing developer for the purpose of this tutorial.</li>
			<li><strong>Credentials:</strong>
				<ol>
					<li>Select Expiration:&nbsp;<strong>Never</strong>.</li>
					<li>Click&nbsp;<strong>+ Product</strong>&nbsp;and select&nbsp;<strong>EdgeMicroTestProduct</strong>&nbsp;(the product you just created)</li>
				</ol>
			</li>
		</ol>
	</li>
	<li>Click&nbsp;<strong>Save</strong>.</li>
	<li>You're back in the Developer Apps list page.</li>
	<li>Select the app you just created,&nbsp;<strong>EdgeMicroTestApp</strong>.</li>
	<li>Click&nbsp;<strong>Show</strong>&nbsp;next to the&nbsp;<strong>Consumer Key</strong>&nbsp;and&nbsp;<strong>Consumer Secret</strong>.</li>
</ol>
<p><img alt="" src="sites/docs/files/edge-micro-dev-app.png" style="width: 969px; height: 162px; border-width: 1px; border-style: solid; margin: 1px;" /></p>
<div class="note">
	<p>You'll need to use these keys later when you configure use API Key or OAuth2 access token security for your API.</p>
</div>
<p>&nbsp;</p>
<h2><a id="Operating Edge Microgateway" name="Operating Edge Microgateway"></a>Part 3: Operate Edge Microgateway</h2>
<p>Now that you have a configured Edge Microgateway and at least one Edge Microgateway-aware proxy on Edge, it's time to start up Edge Microgateway. An Edge Microgateway HTTP server will run on your local machine, and you'll make API calls directly to that server.</p>
<h3>1. Start Edge Microgateway</h3>
<p>Use the&nbsp;<strong>edgemicro</strong>&nbsp;<strong>start&nbsp;</strong>command to start Edge Microgateway.</p>
<ol>
	<li>Be sure you have the keys that were returned previously when you ran the&nbsp;<strong>edgemicro configure</strong>&nbsp;command. That output looked something like this:
		<pre>
You need key and secret while starting edgemicro instance

key: da4778e7c240a5d4585fc559eaba5083328828ac9f3a7f583e8b73e
secret: 3aad7439708b4aeb38ee08e87189921ad00e6fc1ba8a8ae9f929ee2</pre>
	</li>
	<li>(Optional) Print help information for the&nbsp;<code>edgemicro start</code>&nbsp;command.<br />
		<pre>
<strong>edgemicro start -h</strong></pre>
	</li>
	<li>To start Edge Microgateway, execute the following command:
		<pre>
<strong>edgemicro start -o [org] -e [env] -k [key] -s [secret]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><code><strong>key</strong></code>&nbsp;is the key returned previously by the configure command.</li>
			<li><code><strong>secret</strong></code>&nbsp;is the key returned previously by the configure command.</li>
		</ul>
		<p><strong>Example</strong></p>
		<pre>
<strong>edgemicro start -o docs -e test -k 701e70e718ce6dc1880616b3c39177d64a88754d615c7a4e1f78b6181d000723 -s 05c14356e42d136b83dd135cf8a18531ff52d7299134677e30ef4e34ab0cc824</strong></pre>
		<p><strong>Output</strong></p>
		<p>The start command retrieves a lot of configuration information from Apigee Edge (which scrolls into the terminal window). In the output, you'll see a list of microgateway-aware proxies and products that were discovered. At the end of the output, you should see something like this:</p>
		<pre>
...

PROCESS PID : 9757
installed plugin from analytics
installed plugin from oauth
eb725020-a2b0-11e6-8a52-6de156e3a6e2 edge micro listening on port 8000
installed plugin from analytics
installed plugin from oauth
installed plugin from analytics
installed plugin from oauth
installed plugin from analytics
installed plugin from oauth
eb77ce60-a2b0-11e6-8a88-b96278c0c198 edge micro listening on port 8000
eb78b8c0-a2b0-11e6-bf36-717b986c91fe edge micro listening on port 8000
eb77f570-a2b0-11e6-883e-472b9104351e edge micro listening on port 8000</pre>
	</li>
</ol>
<h4>What happened?</h4>
<p>Look at the terminal where you ran the&nbsp;<strong>edgemicro config</strong>&nbsp;command. Scrolling up through the standard output, you can see that the command retrieves a payload of Edge Microgateway configuration information from Apigee Edge. This information includes:</p>
<ul>
	<li>The public key we created and stored previously in the Apigee vault.</li>
	<li>A JSON representation of all Edge Microgateway-aware proxies that exist in the organization/environment. These are all proxies that are named with the prefix&nbsp;<strong>edgemicro_</strong>.</li>
	<li>A JSON representation of all of the API products that exist in the organization/environment.</li>
</ul>
<p>With this information, Edge Microgateway knows which proxies and proxy paths it is allowed to process. It uses the product information to enforce security (in exactly the same way as any API proxy does on Apigee Edge, where developer app keys have an association with products). We'll go through the steps to secure Edge Microgateway shortly.</p>
<h3>2. Test Edge Microgateway</h3>
<p>With Edge Microgateway running, you can call the proxy. The configuration for the&nbsp;<strong>edgemicro_hello</strong>&nbsp;proxy was downloaded from Edge when you started Edge Microgateway. Remember, the proxy basepath is&nbsp;<strong>/hello</strong>.</p>
<p>To test Edge Microgateway, we start with the base path and add a resource path&nbsp;<strong>/echo</strong>. Note that everything after the base path (including any query parameters) is simply passed through to the backend target:</p>
<pre>
<strong>curl -i http://localhost:8000/hello/echo</strong>
{"error":"missing_authorization","error_description":"Missing Authorization header"}</pre>
<p>The error occurs because you did not send a valid API key or access token with the request. By default, Edge Microgateway requires either an API key or an access token on every API call. In the next step of the tutorial, we'll secure this API properly and show you how to obtain a valid access token and include it with the request.</p>
<div class="note"><strong>Debugging problems:</strong>&nbsp;If you have a problem, you can restart Edge Microgateway in debug mode using the&nbsp;<code>--debug</code>&nbsp;flag. For details on running in debug mode, see "Debugging and troubleshooting" in <a href="http://docs.apigee.com/node/25301">http://docs.apigee.com/node/25301</a>. You can also take a look at the Edge Microgateway log files when debugging a problem. For details, see "Managing log files in <a href="http://docs.apigee.com/node/25301">http://docs.apigee.com/node/25301</a>.</div>
<h3>4. Stop Edge Microgateway</h3>
<ol>
	<li>In a separate terminal window,&nbsp;<code>cd</code>&nbsp;to&nbsp;<strong>the same directory</strong>&nbsp;where you started Edge Microgateway.</li>
	<li>Enter the stop command:<br />
		<pre>
<strong>edgemicro stop</strong></pre>
	</li>
</ol>
<div class="note">
	<p>There are three commands that you must run from the same directory where you started Edge Microgateway. These include&nbsp;<strong>stop</strong>,&nbsp;<strong>reload</strong>, and&nbsp;<strong>status</strong>.&nbsp;</p>
</div>
<h2><a id="Secure" name="Secure"></a>Part 4: Secure Edge Microgateway</h2>
<p>You can secure API calls made through Edge Microgateway using an &nbsp;API key or an access token.</p>
<ul>
	<li><a href="#Oauthtoken">Secure API calls with an OAuth2 access token</a></li>
	<li><a href="#apikey option">Secure API calls with an API Key</a></li>
</ul>
<h3>Secure API calls with an OAuth2 access token</h3>
<div class="note"><a>Edge Microgateway does not invoke regular Edge API proxies</a>. An access token generated for Edge Microgateway cannot be used to invoke Edge proxies protected by the OAuthV2 policy. Conversely, access token granted to access Edge proxies cannot be used to access APIs called through Edge Microgateway.&nbsp;To use OAuth2 with Edge Microgateway you must follow the specific instructions provided below in this section.&nbsp;</div>
<p>Follow these steps if you want to authenticate API calls with an OAuth2 access token:</p>
<p><strong>1. Get the required keys</strong></p>
<ol>
	<li>In the Edge UI, navigate to the Developer App you created previously, as described in&nbsp;<a href="#Part2">Part 2: Create entities on Apigee Edge</a>. The name of the App was EdgeMicroTestApp.
		<div class="note">
			<p>Be sure that you have both the&nbsp;<strong>edgemicro_hello</strong>&nbsp;and&nbsp;<strong>edgemicro-auth</strong>&nbsp;proxies listed in the product associated with the app. Also, make sure the developer you associated with the app is active.</p>
		</div>
	</li>
	<li>In the Developer App page, show the Consumer Key and the Consumer Secret, and copy them.&nbsp;<strong>These values are required to obtain an access token in the next step.</strong></li>
</ol>
<p>&nbsp;</p>
<p><strong>2. Get an access token</strong></p>
<p>There are two ways to get an access token. We'll show you both methods.</p>
<p><strong><em>Using the CLI to get an access token</em></strong></p>
<p>The&nbsp;<strong>first method</strong>&nbsp;is convenient, and follows the pattern we've used throughout the tutorial. The&nbsp;<strong>second method</strong>&nbsp;is generally more useful for client app developers who need to request tokens. The actual token endpoint is implemented in the&nbsp;<strong>edgemicro-auth</strong>&nbsp;proxy that was deployed when you configured Edge Microgateway.&nbsp;</p>
<ol>
	<li>(Optional) View help for the&nbsp;<strong>token get</strong>&nbsp;command:
		<pre>
<strong>edgemicro token get -h</strong></pre>
	</li>
	<li>Generate the token, substituting your Consumer Key and Consumer Secret values from the developer app you created on Apigee Edge in the&nbsp;<strong>-i</strong>&nbsp;and&nbsp;<strong>-s</strong>&nbsp;parameters:
		<pre>
<strong>edgemicro token get -o [org] -e [env] -i [consumer_key] -s [consumer_secret]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><code><strong>consumer_id</strong></code>&nbsp;is the Consumer ID in the Developer App you created previously.</li>
			<li><code><strong>consumer_secret&nbsp;</strong></code>is the Consumer Secret in the Developer App you created previously.</li>
		</ul>
		<p><strong>Example</strong></p>
		<pre>
edgemicro token get -o docs -e test -i G0IAeU864EtBo99NvUbn6Z4CBwVcS2 -s uzHTbwNWvoSmOy</pre>
		<p><strong>Output (Sample)</strong></p>
		<pre>
current nodejs version is v4.4.4
{ token: 'eyJ0eXAiOiJKV1QiLCJhbGciSUzI1NiJ9.eyJhcHBsaWNhdGl
vbl9uYW1lIjoiNWNiMGY0tOWMzOC00YmJjLWIzNzEtZGMxZTQzOGYxZGMxI
iwiY2xpZW50X2lkIjoiNVVdBWEdvSU9lbzYwYWV3OTRQN0c1TUFaRTNhSnA
iLCJzY29wZXMiOltdLCJhcGlfcHJvjdF9saXN0IjpbIkVkZ2VNaWNyb1Rlc
3RQcm9kdWN0IlmlhdCI6MTQ3ODIwODMzMiwiZXhwIjoxNDc4MjEwMTMxfQ.
v3Q8Rs0W9FO_XpERwIAMMXhjGamRmmmWgrAy1wJv0-99oajx5ASI5qjNubM
nCF14xxwlVXHcz1VfedA8Nx7Ih145zhWWuPKL9muzhXXnVBRFeBMeeLqJk4
QQ7Bhst7xH_68nJSTE20Egu95DHOCUemfrepDFH0VggY4BmzvwLkBNfz_te
E_YqwKZbpGOLMdKK1vMk0fk0x19SieIMS_aJYeOAklrzUhnFxWJFrsAWsax
NLx_BbQcZzYfK1JSDUrhRNVBuPHMnGjNA_oHw2J4qa6Hsp62PfchG-DIW_t
-0BFnYf3rYXmqyNORqFrOMdl4VxqQ' }</pre>
	</li>
</ol>
<p><strong><em>(Optional) Using the API to get a token</em></strong></p>
<p>If you're used to calling Edge proxies using curl or another HTTP client, you'll be interested to know that you can call the token endpoint directly, rather than using the&nbsp;<strong>edgemicro token</strong>&nbsp;command. Here's a curl example. Just substitute your org and environment names in the URL, and pass the colon-separated Consumer Key:Consumer Secret values in a Basic Authentication header:</p>
<pre>
<strong>curl -i -X POST --user [client_id]:[client_secret] "http://[org]-[env].apigee.net/edgemicro-auth/token" -d '{"grant_type": "client_credentials"}' -H "Content-Type: application/json"</strong></pre>
<p>Where:</p>
<ul>
	<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
	<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
	<li><code><strong>client_id</strong></code>&nbsp;is the Consumer ID in the Developer App you created previously.</li>
	<li><code><strong>client_secret&nbsp;</strong></code>is the Consumer Secret in the Developer App you created previously.</li>
</ul>
<p><strong>Output</strong>&nbsp;<strong>(Sample)</strong></p>
<p>The command, whether you used the&nbsp;<strong>edgemicro token</strong>&nbsp;CLI command or called the endpoint using curl, returns a signed access token that can be used to make client calls. Something like this:</p>
<pre>
MIICpDCCAYwCCQDpIvWlpaZJGDANBgkqhkiG9w0BAQFADAUMRIwEAYDVQQDEwls 
b2NhbGhvc3QwHhcNMTYwNDA3MTcxNTM5WhcNMTYwND4MTcxNTM5WjAUMRIwEAYD 
VQQDEwlsb2NhbGhvc3QwggEiMA0GCSqGSIb3DQEBAUAA4IBDwAwggEKAoIBAQD3 
OAQ+kf5FH0S0yuj05ITqUODuUJspBPberRMbqOZYHcFswhB0Yvg6JKWxKWBDP9o 
Xl96dtgH7xPFRqIU0zI452jkMQ1fPz2mSaGwik245yfBku7olooXKRKTRKOUoXa 
q3Hld/RPxGSsWtiyyYtKex7tuFdq0Knm1EhowdTRGIgjNvudeYMka/XPRXuykhd 
xIDxWj4rdX+4GPx9qT2eTQC5nOAC7XHVL7ys4KqsAiv28vw10u400KstFFS8Qho 
7FaE0bOKLolKKadKyA60ha1XIw/uSTD6ZQFWQ+XM3OaRbXePWXnSZioSxXcZT7L 
hMUKbsRXw/TCvRB51LgNAgMBAAEwDQYJKoZIhvcNAQELBQADgEBAOuR1OmE/W6j 
gRAarJB5EQuTEpI/9Zpg5c5RAGjzLhkazsycn7pal+IymUjCV7D0oIxTVuTM8ZZ 
57kR5hF/C1ZypDN9i+KGP2ovX8WOCCXYtIQECgZPB/L/7/k7BDuKN4vFBvWUe3X 
s2oyjnVWy+ASqsW8gHfj8ekhe22bP240Oqkbyg9SZP9ol1tvJX6+M0thYwcTwAd 
ft929Icey/MOTQC0jB2qm0gnIx/7KInFXfS5KoFRJoGrWDeckr3RdBo2LhnPaeZ 
1gPYIqphZ3HfisF5KlBXoR8oT/Ilym/nq5COlv+3L4tMIk18F7BQZB60SRazifz 
pFkIxepyr/0=
      </pre>
<p><strong>3. Check the configuration in Edge Microgateway</strong></p>
<ol>
	<li>Open the file ~<code>/.edgemicro/org-env-config.yaml.&nbsp;</code>See also "Where is Edge Microgateway installed" in <a href="http://docs.apigee.com/node/25291">http://docs.apigee.com/node/25291</a>.</li>
	<li>Make sure these oauth plugin properties are set to&nbsp;<strong>false</strong>. They're false by default, but it's a good idea to double-check:
		<pre>
oauth:
   allowNoAuthorization: false
   allowInvalidAuthorization: false</pre>
	</li>
	<li>Also in the&nbsp;<code>org-env-config.yaml</code>&nbsp;file, be sure that the oauth plugin is added to the&nbsp;<code>plugins:sequence</code>&nbsp;element, like this::
		<pre>
plugins:
   dir: ../plugins
   sequence:
   - oauth</pre>
	</li>
	<li>If you make any changes to the file,&nbsp;<strong>reload</strong>&nbsp;the changes into the running Edge Microgateway instance. This command reconfigures Edge Microgateway with zero-downtime:
		<pre>
<strong>edgemicro reload -o [org] -e [env] -k [key] -s [secret]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><code><strong>key</strong></code>&nbsp;is the key returned previously by the configure command.</li>
			<li><code><strong>secret</strong></code>&nbsp;is the key returned previously by the configure command.</li>
		</ul>
		<p><strong>Example</strong></p>
		<pre>
<strong>edgemicro reload -o docs -e test -k 701e70ee718ce6dc188016b3c39177d64a88754d615c74e1f78b6181d</strong></pre>
	</li>
</ol>
<p><strong>4. Call the API securely</strong></p>
<p>With an access token in hand, you can now make the API call securely. For example:</p>
<pre>
  <strong>curl -i -H "Authorization: Bearer</strong> eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhcHBsaWNhdGlvbl
9uYW1lIjoiYmU2YmZjYjAtMWQ0Ni00Y2IxLWFiNGQtZTMxNzRlNTAyMDZkIiwiY2xpZW50X2lkIjoiOGxTTTVIRHdyM
VhIT1ZwbmhURExhYW9FVG5STVpwWk0iLCJzY29wZXMiOltdLCJhcGlfcHJvZHVjdF9saXN0IjpbIk1pY3JvZ2F0ZXdh
eVRlQcm9kdWN0Il0sImCI6MTQzNTM0NzY5MiwiZXhwIjoxNDM1MzQ5NDkxfQ.PN30Y6uK1W1f2ONPEsBDB_BT31c6
IsjWGfwpz-p6Vak8r767tAT4mQAjuBpQYv7_IU4DxSrnxXQ_q536QYCP4p4YKfBvyqbnW0Rb2CsPFziy_n8HIczsWO
s0p4czcK63SjONaUpxV9DbfGVJ_-WrSdqrqJB5syorD2YYJPSfrCcgKm-LpJc6HCylElFDW8dHuwApaWcGRSV3l5Wx
4A8Rr-WhTIxDTX7TxkrfI4THgXAo37p3au3_7DPB_Gla5dWTzV4j93xLbXPUbwTHzpaUCFzmPnVuYM44FW5KgvBrV0
64RgPmIFUxSqBWGQU7Z1w2qFmWuaDljrMDoLEreI2g" <strong>http://localhost:8000/hello/echo</strong></pre>
<p>The API returns headers and other information from the mock server.</p>
<h3><strong style="font-size: 12px;"><a id="apikey option" name="apikey option"></a></strong>Securing the API with an API key</h3>
<p>If you wish to use an API key for authorization, follow these steps:</p>
<p><strong>1. Get the API key</strong></p>
<ol>
	<li>In the Edge UI, navigate to the Developer App you created previously, as described in&nbsp;<a href="#Part2">Part 2: Create entities on Apigee Edge</a>. The name of the App was EdgeMicroTestApp.
		<div class="note">
			<p>Be sure that you have both the&nbsp;<strong>edgemicro_hello</strong>&nbsp;and&nbsp;<strong>edgemicro-auth</strong>&nbsp;proxies listed in the product associated with the app. Also, make sure the developer you associated with the app is active.</p>
		</div>
	</li>
	<li>In the Developer App page, show the Consumer Key and copy it.&nbsp;<strong>This value is the API key.</strong>&nbsp;You'll use this key to make authenticated API calls.</li>
</ol>
<p><strong>2. Check the configuration in Edge Microgateway</strong></p>
<ol>
	<li>Open the file ~<code>/.edgemicro/org-env-config.yaml.&nbsp;</code>See also "Where is Edge Microgateway installed" in <a href="http://docs.apigee.com/node/25291">http://docs.apigee.com/node/25291</a>.</li>
	<li>Make sure these oauth plugin properties are set to&nbsp;<strong>false</strong>. They're false by default, but it's a good idea to double-check:
		<pre>
oauth:
   allowNoAuthorization: false
   allowInvalidAuthorization: false</pre>
	</li>
	<li>Also in the&nbsp;<code>org-env-config.yaml</code>&nbsp;file, be sure that the oauth plugin is added to the&nbsp;<code>plugins:sequence</code>&nbsp;element, like this::
		<pre>
plugins:
   dir: ../plugins
   sequence:
   - oauth
    </pre>
	</li>
	<li>If you make any changes to the file,&nbsp;<strong>reload</strong>&nbsp;the changes into the running Edge Microgateway instance. This command reconfigures Edge Microgateway with zero-downtime:
		<pre>
<strong>edgemicro reload -o [org] -e [env] -k [key] -s [secret]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><code><strong>key</strong></code>&nbsp;is the key returned previously by the configure command.</li>
			<li><code><strong>secret</strong></code>&nbsp;is the key returned previously by the configure command.</li>
		</ul>
		<p><strong>Example</strong></p>
		<pre>
<strong>edgemicro reload -o docs -e test -k 701e70ee718ce6dc188016b3c39177d64a88754d615c74e1f78b6181d</strong></pre>
	</li>
</ol>
<p><strong>3. Call the API securely with an API key</strong></p>
<p>Call the API with the&nbsp;<strong>x-api-key</strong>&nbsp;header as follows. The Consumer Key value you copied from the Developer App is the API key. By default, Edge Microgateway expects you to pass the key in a header called&nbsp;<strong>x-api-key</strong>, like this:</p>
<pre>
curl -i http://localhost:8000/hello/echo -H "x-api-key: [apikey]"</pre>
<p>Where:</p>
<ul>
	<li><strong><code>apikey</code></strong>&nbsp;is the Consumer Key value taken from EdgeMicroTestApp.</li>
</ul>
<p>For example:</p>
<pre>
<strong>
curl -i http://localhost:8000/hello/echo -H 'x-api-key: XsU1R4zGXz2ERxa0ilYQ5szwuljr5bB'</strong></pre>
<p>You now have a fully functioning and secure Edge Microgateway. In the next part of the tutorial, we'll take a look at plugins that add functionality to Edge Microgateway.</p>
<p>&nbsp;</p>
<h2><a id="Part4" name="Part4"></a>Part 5: Add a Spike Arrest plugin</h2>
<p>In this part, we'll add a rate-limiting feature called spike arrest to your instance of Edge Microgateway.</p>
<h3>What are plugins?</h3>
<p>A plugin is a Node.js module that adds functionality to Edge Microgateway. Plugin modules follow a consistent pattern and are stored in a location known to Edge Microgateway, enabling the microgateway to discover and load them automatically. You can read more about plugins in the <a href="http://docs.apigee.com/node/25311">http://docs.apigee.com/node/25311</a>.</p>
<h3>Adding the spike arrest plugin</h3>
<p>Spike Arrest protects against traffic spikes. It throttles the number of requests processed by an Edge Microgateway instance.</p>
<p>In Edge Microgateway, spike arrest is implemented as a plugin module. To enable it, you need to add it to the Edge Microgateway configuration file.</p>
<ol>
	<li>Open the file ~<code>/.edgemicro/org-env-config.yaml.&nbsp;</code>See also "Where is Edge Microgateway installed" in <a href="http://docs.apigee.com/node/25291">http://docs.apigee.com/node/25291</a>.</li>
	<li>Add the following element. You can add it anywhere in the file.
		<pre>
   spikearrest:
      timeUnit: minute   
      allow: 10   
      buffersize: 0   </pre>
	</li>
	<li>Add&nbsp;<code>spikearrest</code>&nbsp;to the&nbsp;<code>edgemicro:sequence</code>&nbsp;element, as shown below. The sequence configuration property tells Edge Microgateway the order in which the plugin modules are executed.
		<pre>
edgemicro:
  home: ../gateway
  port: 8000
  max_connections: -1
  max_connections_hard: -1
  logging:
    level: info
    dir: /var/tmp
    stats_log_interval: 60
  plugins:
    dir: ../plugins
  sequence:
    - spikearrest
    - oauth </pre>
	</li>
	<li>Save the config file.</li>
	<li>Reload Edge Microgateway with the&nbsp;<strong>reload</strong>&nbsp;command.&nbsp;<strong>You must run this command from the directory where you started Edge Microgateway.</strong>&nbsp;<br />
		<pre>
<strong>edgemicro reload -o [org] -e [env] -k [key] -s [secret]</strong></pre>
		<p>Where:</p>
		<ul>
			<li><strong><code>org</code></strong>&nbsp;is your Edge organization name (you must be an org administrator).</li>
			<li><strong><code>env</code></strong>&nbsp;is an environment in your org (such as test or prod).</li>
			<li><code><strong>key</strong></code>&nbsp;is the key returned previously by the configure command.</li>
			<li><code><strong>secret</strong></code>&nbsp;is the key returned previously by the configure command.</li>
		</ul>
		<p><strong>Example</strong></p>
		<pre>
<strong>edgemicro reload -o docs -e test -k 701e70ee718ce6dc188016b3c39177d64a88754d615c74e1f78b6181d</strong></pre>
	</li>
	<li>Try calling the API several times in quick succession. After the second call, Edge Microgateway returns this error:
		<pre>
{"message":"SpikeArrest engaged","status":503}
</pre>
	</li>
</ol>
<p>The reason is that spike arrest smooths out the number of calls that can be made over the specified time unit. So, in this case, you can make 10 calls in a minute, or one every 6 seconds.</p>
<p>For more information, see "How does spike arrest work?" in the <a href="http://docs.apigee.com/node/25311">http://docs.apigee.com/node/25311</a>.</p>
<h3>Extra credit: Adding the quota plugin</h3>
<p>Following the same pattern used to configure spike arrest, you can add other plugins, like the quota plugin. Like with spike arrest, the quota plugin is included with every Edge Microgateway installation. A quota specifies the number of request messages that an app is allowed to submit to an API over a specified time interval (minutes or hours).</p>
<p>To learn how quotas work, see "Using the quota plugin" in <a href="http://docs.apigee.com/node/25311">http://docs.apigee.com/node/25311</a>.</p>
<h2><a id="Part5" name="Part5"></a>Part 6: Viewing analytics on Apigee Edge</h2>
<p>We now have a fully functioning Edge Microgateway instance, let's see what's it's been up to! By default, the analytics plugin module is added to Edge Micro. This module silently pushes analytics data from Edge Micro to Apigee edge, where it is consumed by the Edge Analytics system. Let's see:</p>
<ol>
	<li>Log in to your organization on Apigee Edge.</li>
	<li>Select&nbsp;<strong>Analytics &gt; Proxy Performance</strong>.</li>
	<li>In the Proxy Performance dashboard, select the&nbsp;<strong>edgemicro_hello proxy</strong>.</li>
	<li>The graph shows you information about the the proxy's traffic patterns, such as total traffic, average response time, average target response time, and more.</li>
</ol>
<p>You can read more about Edge Analytics dashboards on the Analytics Dashboards home page in the Edge documentation. To learn more about plugins, see <a href="http://docs.apigee.com/node/25311">http://docs.apigee.com/node/25311</a></p>
